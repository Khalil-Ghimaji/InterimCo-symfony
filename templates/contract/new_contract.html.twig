{% extends 'base.html.twig' %}
{% block body %}
    <h1>Nouveau Contrat</h1>
    {{ form_errors(contractForm) }}

    {{ form_start(contractForm) }}
    {{ form_row(contractForm.libelle) }}
    {{ form_row(contractForm.prestations) }}
    <button type="button" id="add-prestation-btn">Add Prestation</button>
    <button>Enregistrer Contrat</button>
    {{ form_end(contractForm) }}
    <script>
            // Get the container for Prestations
            var prestationsContainer = document.getElementById('contract_form_prestations');
            // Add Prestation button click event
            let add_button = document.getElementById('add-prestation-btn');
            add_button.addEventListener('click',function(e) {
                var prototype = prestationsContainer.getAttribute('data-prototype');
                var index = prestationsContainer.children.length/2;

                var newForm = prototype.replace(/<label class="required">__prestation_name__label__<\/label>/g,'');
                newForm = newForm.replace(/__prestation_name__/g, index);

                var tempDiv = document.createElement('div');
                tempDiv.innerHTML = newForm;
                // tempDiv.firstElementChild.classList.add('form-group');
                tempDiv.firstElementChild.querySelectorAll('input, select').forEach((e)=>{
                    e.classList.add('form-control');
                })
                let prestation_header = document.createElement("h2");
                prestation_header.textContent = "prestation "+(index+1);
                prestationsContainer.appendChild(prestation_header);
                prestationsContainer.appendChild(tempDiv.firstChild);

                e.preventDefault();
            });
            add_button.click();
    </script>
{% endblock %}